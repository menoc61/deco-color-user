{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { createContext, useContext, useState, useEffect } from \"react\";\nimport { DataStore } from \"aws-amplify\";\nimport { Order, OrderService, Basket } from \"../models\";\nimport { useAuthContext } from \"./AuthContext\";\nimport { useBasketContext } from \"./BasketContext\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nvar OrderContext = createContext({});\n\nvar OrderContextProvider = function OrderContextProvider(_ref) {\n  var children = _ref.children;\n\n  var _useAuthContext = useAuthContext(),\n      dbUser = _useAuthContext.dbUser;\n\n  var _useBasketContext = useBasketContext(),\n      company = _useBasketContext.company,\n      totalPrice = _useBasketContext.totalPrice,\n      basketServicees = _useBasketContext.basketServicees,\n      basket = _useBasketContext.basket;\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      orders = _useState2[0],\n      setOrders = _useState2[1];\n\n  useEffect(function () {\n    DataStore.query(Order, function (o) {\n      return o.userID(\"eq\", dbUser.id);\n    }).then(setOrders);\n  }, [dbUser]);\n\n  var createOrder = function createOrder() {\n    var newOrder;\n    return _regeneratorRuntime.async(function createOrder$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return _regeneratorRuntime.awrap(DataStore.save(new Order({\n              userID: dbUser.id,\n              Company: company,\n              status: \"NEW\",\n              total: totalPrice\n            })));\n\n          case 2:\n            newOrder = _context.sent;\n            _context.next = 5;\n            return _regeneratorRuntime.awrap(Promise.all(basketServicees.map(function (basketService) {\n              return DataStore.save(new OrderService({\n                quantity: basketService.quantity,\n                orderID: newOrder.id,\n                Service: basketService.Service\n              }));\n            })));\n\n          case 5:\n            _context.next = 7;\n            return _regeneratorRuntime.awrap(DataStore.delete(basket));\n\n          case 7:\n            setOrders([].concat(_toConsumableArray(orders), [newOrder]));\n\n          case 8:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var getOrder = function getOrder(id) {\n    var order, orderServicees;\n    return _regeneratorRuntime.async(function getOrder$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return _regeneratorRuntime.awrap(DataStore.query(Order, id));\n\n          case 2:\n            order = _context2.sent;\n            _context2.next = 5;\n            return _regeneratorRuntime.awrap(DataStore.query(OrderService, function (od) {\n              return od.orderID(\"eq\", id);\n            }));\n\n          case 5:\n            orderServicees = _context2.sent;\n            return _context2.abrupt(\"return\", _objectSpread(_objectSpread({}, order), {}, {\n              services: orderServicees\n            }));\n\n          case 7:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  return _jsx(OrderContext.Provider, {\n    value: {\n      createOrder: createOrder,\n      orders: orders,\n      getOrder: getOrder\n    },\n    children: children\n  });\n};\n\nexport default OrderContextProvider;\nexport var useOrderContext = function useOrderContext() {\n  return useContext(OrderContext);\n};","map":{"version":3,"names":["createContext","useContext","useState","useEffect","DataStore","Order","OrderService","Basket","useAuthContext","useBasketContext","OrderContext","OrderContextProvider","children","dbUser","company","totalPrice","basketServicees","basket","orders","setOrders","query","o","userID","id","then","createOrder","save","Company","status","total","newOrder","Promise","all","map","basketService","quantity","orderID","Service","delete","getOrder","order","od","orderServicees","services","useOrderContext"],"sources":["C:/Users/MENO/Desktop/PROJECT/APP-DECO-COLOR/deco-color-user/src/contexts/OrderContext.js"],"sourcesContent":["import { createContext, useContext, useState, useEffect } from \"react\";\nimport { DataStore } from \"aws-amplify\";\nimport { Order, OrderService, Basket } from \"../models\";\nimport { useAuthContext } from \"./AuthContext\";\nimport { useBasketContext } from \"./BasketContext\";\n\nconst OrderContext = createContext({});\n\nconst OrderContextProvider = ({ children }) => {\n  const { dbUser } = useAuthContext();\n  const { company, totalPrice, basketServicees, basket } = useBasketContext();\n\n  const [orders, setOrders] = useState([]);\n\n  useEffect(() => {\n    DataStore.query(Order, (o) => o.userID(\"eq\", dbUser.id)).then(setOrders);\n  }, [dbUser]);\n\n  const createOrder = async () => {\n    // create the order\n    const newOrder = await DataStore.save(\n      new Order({\n        userID: dbUser.id,\n        Company: company,\n        status: \"NEW\",\n        total: totalPrice,\n      })\n    );\n\n    // add all basketServicees to the order\n    await Promise.all(\n      basketServicees.map((basketService) =>\n        DataStore.save(\n          new OrderService({\n            quantity: basketService.quantity,\n            orderID: newOrder.id,\n            Service: basketService.Service,\n          })\n        )\n      )\n    );\n\n    // delete basket\n    await DataStore.delete(basket);\n\n    setOrders([...orders, newOrder]);\n  };\n\n  const getOrder = async (id) => {\n    const order = await DataStore.query(Order, id);\n    const orderServicees = await DataStore.query(OrderService, (od) =>\n      od.orderID(\"eq\", id)\n    );\n\n    return { ...order, services: orderServicees };\n  };\n\n  return (\n    <OrderContext.Provider value={{ createOrder, orders, getOrder }}>\n      {children}\n    </OrderContext.Provider>\n  );\n};\n\nexport default OrderContextProvider;\n\nexport const useOrderContext = () => useContext(OrderContext);\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}